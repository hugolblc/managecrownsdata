<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>What the Package Does (One Line, Title Case) • managecrownsdata</title>
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="What the Package Does (One Line, Title Case)">
<meta name="description" content="Design to handle crown observatories data.">
<meta property="og:description" content="Design to handle crown observatories data.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">managecrownsdata</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/extract_crowns_data.html">extract_crowns_data</a></li>
    <li><a class="dropdown-item" href="articles/plot_labels.html">plot_labels</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hugolblc/managecrownsdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="managecrownsdata">managecrownsdata<a class="anchor" aria-label="anchor" href="#managecrownsdata"></a>
</h1></div>
<ul>
<li><a href="#the-package">The package</a></li>
<li><a href="#citation">Citation</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#id_#environment-setup">Environment setup</a></li>
<li><a href="#id_##metashape-license-activation">Metashape license activation</a></li>
<li><a href="#usage-exemple-on-small-dataset">Usage exemple on small dataset</a></li>
<li><a href="#id_#time-sift">Time-SIFT</a></li>
<li><a href="#id_##resulting-orthomosaics">Resulting orthomosaics</a></li>
<li><a href="#id_#arosics">Arosics</a></li>
<li><a href="#id_#vegetation-indexes">Vegetation indexes</a></li>
</ul>
<!-- badges: start --><!-- badges: end -->
</div>
<div class="section level1">
<h1 id="the-package">The package<a class="anchor" aria-label="anchor" href="#the-package"></a>
</h1>
<p>This R package aims at streamlining, standardizing and facilitating processing of repetead UAV surveys from R. It focuses (for now) on RGB data. It notably allows generating 3D and 4D mosaics &amp; mosaics spatial alignment using state-of-the-art approaches, provides tools to generate reference labels, segment crowns (?) and classify crown phenophases.</p>
</div>
<div class="section level1">
<h1 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h1>
<p>To cite ‘managecrownsdata’, please use citation(‘managecrownsdata’).</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<div class="section level2">
<h2 id="environment-setup">Environment setup<a class="anchor" aria-label="anchor" href="#environment-setup"></a>
</h2>
<div class="section level3">
<h3 id="r-package">R package<a class="anchor" aria-label="anchor" href="#r-package"></a>
</h3>
<p>If not already installed, you can use devtools to install the “managecrownsdata” package :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu">install_github</span><span class="op">(</span><span class="st">"https://github.com/hugolblc/managecrownsdata.git"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="python-environment">Python environment<a class="anchor" aria-label="anchor" href="#python-environment"></a>
</h2>
<p>First, make sure you have python&gt;3.9 and anaconda / miniconda installed on your device. If not, you can download them using the following links :</p>
<p><a href="https://www.python.org/downloads/" class="external-link uri">https://www.python.org/downloads/</a> <a href="https://www.anaconda.com/download/" class="external-link uri">https://www.anaconda.com/download/</a></p>
<p>After completing the installation steps, you can create your own python environment that will contain everything you need to call this package’s functions</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Imports</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hugolblc/managecrownsdata" class="external-link">managecrownsdata</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Python env creation</span></span>
<span><span class="va">env_name</span> <span class="op">&lt;-</span> <span class="st">"managecrownsdata_env"</span>   <span class="co">#use the name you want for your environment</span></span>
<span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/conda-tools.html" class="external-link">conda_create</a></span><span class="op">(</span><span class="va">env_name</span>, environment <span class="op">=</span> <span class="st">"environment.yaml"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_condaenv</a></span><span class="op">(</span><span class="va">env_name</span><span class="op">)</span></span></code></pre></div>
<p>The environment you just created contains already all necessary dependences but the Metashape python API, which is required to align photos using TimeSIFT. To install it, you first need to download a file from the Metashape website : <a href="https://www.agisoft.com/downloads/installer/" class="external-link uri">https://www.agisoft.com/downloads/installer/</a>. Go to the “Python 3 module” section and click on the link corresponding to your operating system. This should download a file named “Metashape[…].whl”. Then, copy the path to the downloaded .whl file below</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add metashape API to env</span></span>
<span><span class="va">path_to_whl_file</span> <span class="op">&lt;-</span> <span class="st">"C:/Users/user1/Downloads/Metashape-2.1.3-cp37.cp38.cp39.cp310.cp311-none-win_amd64.whl"</span>   <span class="co">#replace with your path</span></span>
<span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_install.html" class="external-link">py_install</a></span><span class="op">(</span><span class="va">path_to_whl_file</span>, envname <span class="op">=</span> <span class="va">env_name</span>, pip<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="metashape-license-activation">Metashape license activation<a class="anchor" aria-label="anchor" href="#metashape-license-activation"></a>
</h3>
<p>Your python environment should be ready for use now. However, Agisoft Metashape requires a paid license in order to access all its features. It is not necessary to have the Metashape application installed on your device in order for the python API to work, but whether or not the application is installed and/or activated, the API still needs to be activated using a license key (it can be the same used for the application if it is already installed).</p>
<p>To activate the key, follow these steps :</p>
<ul>
<li>Open an anaconda command prompt</li>
<li>Activate the environnement you just created : $ conda activate managecrownsdata_env</li>
<li>start python and activate the licence : $ python &gt;&gt;&gt; import Metashape &gt;&gt;&gt; Metashape.license.activate(“AAAA-BBBB-CCCC-DDDD”) #replace with your license key</li>
</ul>
<p>If that works, you can close the command prompt. You should be good to go !</p>
<hr>
</div>
</div>
</div>
<div class="section level1">
<h1 id="usage-exemple-on-small-dataset">Usage exemple on small dataset<a class="anchor" aria-label="anchor" href="#usage-exemple-on-small-dataset"></a>
</h1>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Imports</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hugolblc/managecrownsdata" class="external-link">managecrownsdata</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="fu">rstudioapi</span><span class="fu">::</span><span class="fu">getSourceEditorContext</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">path</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_condaenv</a></span><span class="op">(</span><span class="st">"C:/Users/U051-U219/miniconda3/envs/env_R"</span><span class="op">)</span></span></code></pre></div>
<p>Please download the exemple data at : …, and extract it into the package folder</p>
<p>Our test data consists of a few drone images of the same zone taken at two different dates :</p>
<img src="inst/images/Capture1.JPG" width="800" height="500" align="justify"><figcaption align="justify">
Title
</figcaption><div class="section level2">
<h2 id="time-sift">Time-SIFT<a class="anchor" aria-label="anchor" href="#time-sift"></a>
</h2>
<p>First, we will use the Time-SIFT method to align all the photos with each other and generate an orthomosaic for each date. This is a rather long process that should take 10~15 minutes to complete on this test data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Try TimeSIFT on test data</span></span>
<span></span>
<span><span class="fu"><a href="reference/Time_SIFT_in_r.html">Time_SIFT_in_r</a></span><span class="op">(</span><span class="st">"test_data/my_drone_data"</span>, </span>
<span>               out_dir_ortho <span class="op">=</span> <span class="st">"test_data/outputs_TS/ORTHO"</span>, </span>
<span>               <span class="co">#out_dir_DEM = "test_data/outputs_TS/DEM",</span></span>
<span>               data_type <span class="op">=</span> <span class="st">"RGB"</span>,</span>
<span>               crs <span class="op">=</span> <span class="st">"EPSG::32633"</span>,</span>
<span>               site_name <span class="op">=</span> <span class="st">"Bouamir"</span>,</span>
<span>               <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Conversion to png for display purposes</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/magick/" class="external-link">magick</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">image_write</span><span class="op">(</span><span class="fu">image_read</span><span class="op">(</span><span class="st">"test_data/outputs_TS/ORTHO/Bouamir_20220427_ORTHO.tif"</span><span class="op">)</span>, path <span class="op">=</span> <span class="st">"test_data/outputs_TS/ORTHO/Bouamir_20220427_ORTHO.png"</span>, format <span class="op">=</span> <span class="st">"png"</span>, quality<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu">image_write</span><span class="op">(</span><span class="fu">image_read</span><span class="op">(</span><span class="st">"test_data/outputs_TS/ORTHO/Bouamir_20220511_ORTHO.tif"</span><span class="op">)</span>, path <span class="op">=</span> <span class="st">"test_data/outputs_TS/ORTHO/Bouamir_20220511_ORTHO.png"</span>, format <span class="op">=</span> <span class="st">"png"</span>, quality<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<img src="inst/images/Capture2.JPG" width="800" height="500" align="justify"><figcaption align="justify">
Title
</figcaption><div class="section level3">
<h3 id="resulting-orthomosaics-">Resulting orthomosaics :<a class="anchor" aria-label="anchor" href="#resulting-orthomosaics-"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="arosics">Arosics<a class="anchor" aria-label="anchor" href="#arosics"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Try arosics on test data</span></span>
<span><span class="fu"><a href="reference/arosics_in_r.html">arosics_in_r</a></span><span class="op">(</span>path_in <span class="op">=</span> <span class="st">"test_data/outputs_TS/ORTHO/Bouamir_20220427_ORTHO.tif"</span>,</span>
<span>             ref_filepath <span class="op">=</span> <span class="st">"test_data/Bouamir_LiDAR_mars2022_ref_red.tif"</span>, </span>
<span>             <span class="co">#"D:/managecrownsdata/test_data/outputs_TS/ORTHO4/20220511_ORTHO.tif",</span></span>
<span>             out_dir_path <span class="op">=</span> <span class="st">"test_data/outputs_arosics"</span>,</span>
<span>             corr_type <span class="op">=</span> <span class="st">"global"</span>,</span>
<span>             <span class="co">#grid_res = 200,</span></span>
<span>             window_size <span class="op">=</span> <span class="fl">500</span>,</span>
<span>             window_pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">258131</span>, <span class="fl">352973</span><span class="op">)</span>,</span>
<span>             save_data <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="vegetation-indexes">Vegetation indexes<a class="anchor" aria-label="anchor" href="#vegetation-indexes"></a>
</h2>
<p>Now that you have correctly aligned orthomosaics, you can use a crown delimitation shapefile to do multiple actions, such as computing indexes for each of these crowns :</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">managecrownsdata</span><span class="fu">::</span><span class="fu"><a href="reference/extract_rgbValues.html">extract_rgbValues</a></span><span class="op">(</span>crownsFile <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">"test_data/Bouamir_crowns_2024_11_04_filtered.gpkg"</span><span class="op">)</span>, </span>
<span>                         path_images <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"test_data/outputs_arosics/"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                         <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/hugolblc/managecrownsdata/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/hugolblc/managecrownsdata/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing managecrownsdata</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Hugo Leblanc <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hugo Leblanc.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
