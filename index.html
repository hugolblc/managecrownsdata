<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>What the Package Does (One Line, Title Case) • managecrownsdata</title>
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="What the Package Does (One Line, Title Case)">
<meta name="description" content="Design to handle crown observatories data.">
<meta property="og:description" content="Design to handle crown observatories data.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">managecrownsdata</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/generate_orthomosaics.html">generate_orthomosaics</a></li>
    <li><a class="dropdown-item" href="articles/workflow.html">workflow</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hugolblc/managecrownsdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="managecrownsdata">managecrownsdata<a class="anchor" aria-label="anchor" href="#managecrownsdata"></a>
</h1></div>
<ul>
<li><a href="#the-package">The package</a></li>
<li><a href="#citation">Citation</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#how-to-use-managecrownsdata">How to use managecrownsdata</a></li>
<li><a href="#general-advices">General advices</a></li>
<li><a href="#workflow">Workflow</a></li>
<li><a href="#step-1-and-2">STEP : 1 and 2</a></li>
<li><a href="#step-3-generate-orthomosaics">STEP 3 : Generate orthomosaics</a></li>
<li><a href="#step-4-create-nonna-bboximages">STEP 4 : create_nonNA_bboxImages()</a></li>
<li><a href="#step-5-extract-crowns-images">STEP 5 : Extract crowns images</a></li>
<li><a href="#step-6-create-labeling-file">STEP 6 : Create labeling file</a></li>
<li><a href="#step-7-extract-rgb-metrics-and-merge-them-with-labels">STEP 7 : Extract RGB metrics and merge them with labels</a></li>
<li><a href="#step-8-analyses">STEP 8 : Analyses</a></li>
</ul>
<!-- badges: start --><!-- badges: end -->
</div>
<div class="section level1">
<h1 id="the-package">The package<a class="anchor" aria-label="anchor" href="#the-package"></a>
</h1>
<p>This R package aims at streamlining, standardizing and facilitating processing of repetead UAV surveys from R. It focuses (for now) on RGB data. It notably allows generating 3D and 4D mosaics &amp; mosaics spatial alignment using state-of-the-art approaches, provides tools to generate reference labels, segment crowns (not now) and classify crown phenophases (not now).</p>
</div>
<div class="section level1">
<h1 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h1>
<p>To cite ‘managecrownsdata’, please use citation(‘managecrownsdata’).</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu">install_github</span><span class="op">(</span><span class="st">"https://github.com/hugolblc/managecrownsdata.git"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h1>
<p>In addition to the usual R package documentation, we also have extensive docs and examples <a href="https://hugolblc.github.io/managecrownsdata/">here</a></p>
</div>
<div class="section level1">
<h1 id="how-to-use-managecrownsdata">How to use managecrownsdata<a class="anchor" aria-label="anchor" href="#how-to-use-managecrownsdata"></a>
</h1>
<div class="section level2">
<h2 id="python-environment">Python environment<a class="anchor" aria-label="anchor" href="#python-environment"></a>
</h2>
<p>First, make sure you have python&gt;3.9 and anaconda / miniconda installed on your device. If not, you can download them using the following links :</p>
<p><a href="https://www.python.org/downloads/" class="external-link uri">https://www.python.org/downloads/</a> <a href="https://www.anaconda.com/download/" class="external-link uri">https://www.anaconda.com/download/</a></p>
<p>After completing the installation steps, you can create your own python environment that will contain everything you need to call this package’s functions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Imports</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hugolblc/managecrownsdata" class="external-link">managecrownsdata</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Python env creation</span></span>
<span><span class="va">env_name</span> <span class="op">&lt;-</span> <span class="st">"managecrownsdata_env"</span>   <span class="co"># use the name you want for your environment</span></span>
<span><span class="va">environment</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"managecrownsdata"</span><span class="op">)</span>, <span class="st">'PYTHON/environment.yaml'</span><span class="op">)</span>   <span class="co"># use the environment.yaml file included in the package</span></span>
<span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/conda-tools.html" class="external-link">conda_create</a></span><span class="op">(</span><span class="va">env_name</span>, environment <span class="op">=</span> <span class="va">environment</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_condaenv</a></span><span class="op">(</span><span class="va">env_name</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="metashape">Metashape<a class="anchor" aria-label="anchor" href="#metashape"></a>
</h2>
<p>The environment you just created contains already all necessary dependences but the Metashape python API, which is required to align photos using TimeSIFT. To install it, you first need to download a file from the Metashape website : <a href="https://www.agisoft.com/downloads/installer/" class="external-link uri">https://www.agisoft.com/downloads/installer/</a>. Go to the “Python 3 module” section and click on the link corresponding to your operating system. This should download a file named “Metashape[…].whl”. Then, copy the path to the downloaded .whl file below</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add metashape API to env</span></span>
<span><span class="va">path_to_whl_file</span> <span class="op">&lt;-</span> <span class="st">"MYPATH/Metashape-2.1.3-cp37.cp38.cp39.cp310.cp311-none-win_amd64.whl"</span>   <span class="co">#replace with your path</span></span>
<span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_install.html" class="external-link">py_install</a></span><span class="op">(</span><span class="va">path_to_whl_file</span>, envname <span class="op">=</span> <span class="va">env_name</span>, pip<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="metashape-license-activation">Metashape license activation<a class="anchor" aria-label="anchor" href="#metashape-license-activation"></a>
</h3>
<p>Your python environment should be ready for use now. However, Agisoft Metashape requires a paid license in order to access all its features. It is not necessary to have the Metashape application installed on your device in order for the python API to work, but whether or not the application is installed and/or activated, the API still needs to be activated using a license key (it can be the same used for the application if it is already installed).</p>
<p>To activate the key, follow these steps :</p>
<ul>
<li>Open an anaconda command prompt</li>
<li>Activate the environnement you just created : $ conda activate managecrownsdata_env</li>
<li>start python and activate the licence : $ python &gt;&gt;&gt; import Metashape &gt;&gt;&gt; Metashape.license.activate(“AAAA-BBBB-CCCC-DDDD”) # replace with your license key</li>
</ul>
<p>If that works, you can close the command prompt. You should be good to go !</p>
</div>
</div>
</div>
<div class="section level1">
<h1 id="general-advices">General advices<a class="anchor" aria-label="anchor" href="#general-advices"></a>
</h1>
<p>In order to facilitate your use of our package and ensure that you will not be lost when following the documentation, we strongly recommend you to following the workflow given below. To create this architecture you can use the function <a href="https://hugolblc.github.io/managecrownsdata/reference/create_files_architecture.html"><code>create_files_architecture()</code></a> .</p>
<figure><img src="reference/figures/steps.gif" alt="Recommanded workflow"><figcaption aria-hidden="true">
Recommanded workflow
</figcaption></figure>
</div>
<div class="section level1">
<h1 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h1>
<p>One of the main function of the package is to generate orthomosaics, using the Metashape python API and arosics(<a href="https://github.com/GFZ/arosics" class="external-link">AROSICS</a>) within the functions <a href="https://hugolblc.github.io/managecrownsdata/reference/Time_SIFT.html"><code>Time_SIFT()</code></a> and <a href="https://hugolblc.github.io/managecrownsdata/reference/arosics.html"><code>arosics()</code></a>. These steps required a Metashape license. To guide you step by step into the mosaic generating process you will find a <a href="https://hugolblc.github.io/managecrownsdata/articles/generate_orthomosaics.html">tutoriel</a> that require the <a href="https://filesender.renater.fr/?s=download&amp;token=e67ac550-0546-4204-9a5a-24989cc0aff3" class="external-link">test dataset</a>.</p>
<p>If you don’t have valid Metashape licence but already have the orthomosaics, you will find a tutoriel and test data here for the other package functions <a href="https://hugolblc.github.io/managecrownsdata/articles/workflow.html">here</a>.</p>
</div>
<div class="section level1">
<h1 id="id_1-and-2">1 and 2<a class="anchor" aria-label="anchor" href="#id_1-and-2"></a>
</h1>
<ul>
<li><p>1*<br>
Use the function <a href="https://hugolblc.github.io/managecrownsdata/reference/create_files_architecture.html"><code>create_files_architecture()</code></a> to create the recommended files architecture.</p></li>
<li><p>2*<br>
Manually add your files (raw rgb images and crowns file) to the correct folders.</p></li>
<li><p>Add your rgb images into the ‘1_drone_images’ folder</p></li>
</ul>
<p>Structure your data in one of the following ways : either place one folder by flight directly in your input folder, or use one directory by date, each consisting of subdirectories for each flight (see exemples below). In both cases, the date must be indicated in the name of the folders directly containing images, in the YYYYMMDD or YYYYMM formats.</p>
<div class="figure" style="text-align: center">
<img src="reference/figures/drone_images_achitecture.jpg" alt="Accepted folder structures" width="100%"><p class="caption">
Accepted folder structures
</p>
</div>
<ul>
<li>Add your crowns data files into the ‘4_crowns’ folder</li>
</ul>
</div>
<div class="section level1">
<h1 id="id_3-generate-orthomosaics">3 Generate orthomosaics<a class="anchor" aria-label="anchor" href="#id_3-generate-orthomosaics"></a>
</h1>
<p>One of the main functions of the package is to generate orthomosaics in R, using &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD arosics(<a href="https://github.com/GFZ/arosics" class="external-link">AROSICS</a>) and the Metashape python API. To guide you step by step into the workflow, you should download the test dataset <a href="https://filesender.renater.fr/?s=download&amp;token=e67ac550-0546-4204-9a5a-24989cc0aff3" class="external-link">here</a> and follow the instructions <a href="https://hugolblc.github.io/managecrownsdata/articles/generate_orthomosaics.html">here</a> ======= arosics(<a href="https://github.com/GFZ/arosics" class="external-link">AROSICS</a>) and the Metashape python API. To guide you step by step into the workflow, you should download the test dataset <a href="https://zenodo.org/records/14748367?preview=1&amp;token=eyJhbGciOiJIUzUxMiJ9.eyJpZCI6IjY3MjE2Y2M1LTY4NjctNDEwNS1hMTViLTkwNmMzNGM0YzA5NCIsImRhdGEiOnt9LCJyYW5kb20iOiJkYjhlMWZhMDZiYmNkNTg2YzA4OGYxMTg0ODE3MmI3YiJ9.xKZdG_R2NvApekkLM4FanVbM-ZWbGqNjXYucPKydbzeLdur08A69N9ROgeTdPR42PP_OrL4eF_hljxh3wQHfwA" class="external-link">here</a> and follow the instructions <a href="https://hugolblc.github.io/managecrownsdata/articles/generate_orthomosaics.html">here</a> &gt;&gt;&gt;&gt;&gt;&gt;&gt; 04eb8136b0565962b74c1336fb90bf6b68edc3f3</p>
<p>Our test data consists of a few drone images of the same zone taken at two different dates. The functions <a href="https://hugolblc.github.io/managecrownsdata/reference/Time_SIFT.html"><code>Time_SIFT()</code></a> and <a href="https://hugolblc.github.io/managecrownsdata/reference/arosics.html"><code>arosics()</code></a> will be used to generate and co-registrate the two orthomosaics.</p>
<div class="figure" style="text-align: center">
<img src="reference/figures/generate_mosaics.JPG" alt="Generate mosaics from drone images" width="100%"><p class="caption">
Generate mosaics from drone images
</p>
</div>
</div>
<div class="section level1">
<h1 id="step-4-create-nonna-bboximages">STEP 4 create nonNA bboxImages<a class="anchor" aria-label="anchor" href="#step-4-create-nonna-bboximages"></a>
</h1>
<div class="figure" style="text-align: center">
<img src="reference/figures/create_nonNA_bboxImages.jpg" alt="Extract crowns images" width="100%"><p class="caption">
Extract crowns images
</p>
</div>
</div>
<div class="section level1">
<h1 id="step-5-extract-crowns-images">STEP 5 Extract crowns images<a class="anchor" aria-label="anchor" href="#step-5-extract-crowns-images"></a>
</h1>
<p>To guide you step by step into the workflow, we should follow the instructions <a href="https://hugolblc.github.io/managecrownsdata/articles/extract_crowns_images.html">here</a></p>
<p>To run the exemples, all data are included into the packages. In order to reduce the size of the data, we have reduced the spatial resolution of images.</p>
<div class="figure" style="text-align: center">
<img src="reference/figures/extract_images.jpg" alt="Extract crowns images" width="100%"><p class="caption">
Extract crowns images
</p>
</div>
</div>
<div class="section level1">
<h1 id="step-6-create-labeling-file">STEP 6 Create labeling file<a class="anchor" aria-label="anchor" href="#step-6-create-labeling-file"></a>
</h1>
<p>Once you have the crowns images you can associate manually a label which difine the vegetative and/or reproductive state of trees a the different date. To do it you should create a xlsx file whith the <code><a href="reference/create_labelingFile.html">create_labelingFile()</a></code> function. More information <a href="https://hugolblc.github.io/managecrownsdata/reference/create_labellingFile.html">here</a></p>
<div class="figure" style="text-align: center">
<img src="reference/figures/create_labellingFile.jpg" alt="Labeling file to do manual labelling" width="50%"><p class="caption">
Labeling file to do manual labelling
</p>
</div>
</div>
<div class="section level1">
<h1 id="step-7-extract-rgb-metrics-and-merge-them-with-labels">STEP 7 Extract RGB metrics and merge them with labels<a class="anchor" aria-label="anchor" href="#step-7-extract-rgb-metrics-and-merge-them-with-labels"></a>
</h1>
</div>
<div class="section level1">
<h1 id="step-8-analyses">STEP 8 Analyses<a class="anchor" aria-label="anchor" href="#step-8-analyses"></a>
</h1>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/hugolblc/managecrownsdata/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/hugolblc/managecrownsdata/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing managecrownsdata</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Hugo Leblanc <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hugo Leblanc.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
